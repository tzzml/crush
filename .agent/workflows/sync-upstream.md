---
description: 如何将本项目（Fork 分支）与上游仓库同步
---

# 项目同步与沟通规范

## 沟通规范
- **语言偏好**：始终使用 **中文** 进行回复。

## 同步逻辑 (Upstream Sync Logic)
由于本项目是在原项目基础上增加了 `api` 目录，并对 `internal` 目录进行了少量定制化修改，未来同步时应遵循以下逻辑：

### 1. 配置上游远程仓库 (一次性操作)
如果尚未配置，需添加上游地址：
```bash
git remote add upstream https://github.com/charmbracelet/crush.git
```

### 2. 获取更新
```bash
git fetch upstream
```

### 3. 合并更新
建议使用 `merge` 而不是 `rebase`，以保留清晰的合并历史，特别是考虑到 `internal` 中存在冲突的可能性：
```bash
git merge upstream/main
```

### 4. 冲突处理策略
- **`api/` 目录**：上游通常不包含此目录，合并时会自动保留，无需干预。
- **`internal/` 目录**：
    - 如果上游和本地修改了不同的文件：Git 会自动处理。
    - 如果修改了相同的文件：需要根据业务逻辑手动裁决。通常应优先保留上游的逻辑更新，除非是个性化定制的必要修改。
- **`go.mod` / `go.sum`**：
    - 这是最容易产生冲突的地方。解决方法是接受冲突标记，然后运行：
    ```bash
    go mod tidy
    ```
    这会自动根据当前代码需要的依赖来平衡版本。

### 5. 验证
合并后务必运行项目测试或构建，确保上游的 `internal` 变更没有破坏本地的 `api` 实现。

---
**注意**：在执行任何同步操作前，请确保当前工作区是干净的 (`git status`)。
